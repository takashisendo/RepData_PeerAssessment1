---
title: 'Reproducible Research: Peer Assignment 1'
author: "Takashi Sendo"
date: "2017/1/27"
output:
  html_document:
        keep_md: true
  pdf_document: default
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## Loading and preprocessing the data:

```{r read data, echo=TRUE}
Activity<- read.csv(unz("./activity.zip","activity.csv"),header=TRUE)
#### changing column order
Activity<-Activity[,c(2,1,3)]
Activity_wo_NA<-na.omit(Activity)

```

## What is mean total number of steps taken per day?

```{r, echo=TRUE}
StepMean<-aggregate(Activity_wo_NA[, 2], list(Activity_wo_NA$date), mean)
StepMedian<-aggregate(Activity_wo_NA[, 2], list(Activity_wo_NA$date), median)
Step<-cbind(StepMean,StepMedian[,2])
colnames(StepMean) <- c("date", "mean","median")
hist(StepMean$mean, xlab = "average step by day",main = "Histogram of Average Mean by Day",breaks = 10)
```

## What is the average daily activity pattern?

```{r, echo=TRUE}
StepMean2<-aggregate(Activity_wo_NA[,2], list(Activity_wo_NA$interval), mean)
colnames(StepMean2) <- c("interval","mean_step")
with(StepMean2,plot(x=interval,y=mean_step,type="l",ylab = "mean_step",xlab="interval",main="Interval vs. Average Step"))
### Max mean_step is found at interval:
StepMean2[which.max(StepMean2$mean_step),1]
```

## Imputing missing values

```{r, echo=TRUE}
#### coubting number of NA in "steps"
num_na=plyr::count(is.na(Activity$steps))
#### number of NA
num_na[2,2]
#### imputing NA to 0
Activity$steps[is.na(Activity$steps)]<-0
StepMean_na0<-aggregate(Activity[, 2], list(Activity$date), mean)
colnames(StepMean_na0) <- c("date", "mean")
## average daily steps
StepMean_na0

## interval to give maximum steps
StepMean_na02<-aggregate(Activity[,2], list(Activity$interval), mean)
colnames(StepMean_na02) <- c("interval","mean_step")
 
### Max mean_step is found at interval:
StepMean_na02[which.max(StepMean_na02$mean_step),1]
```

Both original data (removing na) and one imputed for NA give th same result.

## Are there differences in activity patterns between weekdays and weekends?
```{r, echo=TRUE}
Activity_wo_NA$wDay1<-as.POSIXlt(Activity_wo_NA$date)$wday
#### number to represent days of week to handle the Japanese language
weekdays<-c(1,2,3,4,5)
Activity_wo_NA$wDay2<- factor(Activity_wo_NA$wDay1 %in% weekdays, levels=c(FALSE, TRUE), labels=c('weekend','weekday') )
which_weekdays <- Activity_wo_NA$wDay2 == "weekday"  ## subset weekday rows
which_weekends <- Activity_wo_NA$wDay2 == "weekend"  ## subset weekend rows

## Calculating average number of steps per interval across weekdays and
## weekends
StepsPerInterval_weekday <- tapply(Activity_wo_NA$steps[which_weekdays], as.factor(Activity_wo_NA$interval[which_weekdays]),mean, na.rm = T)
StepsPerInterval_weekend <- tapply(Activity_wo_NA$steps[which_weekends], as.factor(Activity_wo_NA$interval[which_weekends]), mean, na.rm = T)

## Plot results in panel plot
par(mfcol = c(2, 1))

  plot(levels(as.factor(Activity_wo_NA$interval)), StepsPerInterval_weekday, type = "l", 
    xlab = "Interval", ylab = "Average number of steps", main = "Average number of steps per interval in weekday", ylim = range(0:400), xlim = range(0:2400))

plot(levels(as.factor(Activity_wo_NA$interval)), StepsPerInterval_weekend, type = "l", 
    xlab = "Interval", ylab = "Average number of steps", main = "Average number of steps per interval in weekend", 
    ylim = range(0:400), xlim = range(0:2400))


```

There is a differenc between pattern of the distributino of steps: one in weekends spreads more evenly to larger interval, while one in weekday is skewed to lower interval, reflecting time available to do excersise in weekdays.